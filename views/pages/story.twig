{{include('partials/header.twig')}}

<div class="block-page"></div>

<div class="hover-informations">
  <!-- Item information-element : BEGIN -->
  <div class="information-element">
    <div class="circle-pointer">
      <div class="circle-hover">
        <div class="line"></div>
      </div>
    </div>
    <div class="information-panel">
      <div class="title">Un regard éclatant</div>
      <div class="description">Your wedding day is important, nobody needs to remind you of that. You are going to be the center of attention (at long last!) as all eyes will be on you and your groom. Even though your friends and family are there to cheer you on and celebrate the great day along with you, it can still be incredibly nerve wracking to have to stand in front of them all and try desperately to look your best.</div>
      <div class="source">Source : Wikipedia.com</div>
      <div class="aside-picture"><img src="{{app.request.basepath}}/src/images/images-story/emilia-clarke-small-1.png" alt=""></div>
    </div>
  </div>
  <!-- Item information-element : END -->
  <!-- Item information-element : BEGIN -->
  <div class="information-element">
    <div class="circle-pointer">
      <div class="circle-hover">
        <div class="line"></div>
      </div>
    </div>
    <div class="information-panel">
      <div class="title">Des lèvres à croquer</div>
      <div class="description">Your wedding day is important, nobody needs to remind you of that. You are going to be the center of attention (at long last!) as all eyes will be on you and your groom. Even though your friends and family are there to cheer you on and celebrate the great day along with you, it can still be incredibly nerve wracking to have to stand in front of them all and try desperately to look your best.</div>
      <div class="source">Source : Wikipedia.com</div>
      <div class="aside-picture"><img src="{{app.request.basepath}}/src/images/images-story/emilia-clarke-small-2.png" alt=""></div>
    </div>
  </div>
  <!-- Item information-element : END -->
  <!-- Item information-element : BEGIN -->
  <div class="information-element">
    <div class="circle-pointer">
      <div class="circle-hover">
        <div class="line left"></div>
      </div>
    </div>
    <div class="information-panel left">
      <div class="title">Une chevelure divine</div>
      <div class="description">Your wedding day is important, nobody needs to remind you of that. You are going to be the center of attention (at long last!) as all eyes will be on you and your groom. Even though your friends and family are there to cheer you on and celebrate the great day along with you, it can still be incredibly nerve wracking to have to stand in front of them all and try desperately to look your best.</div>
      <div class="source">Source : Wikipedia.com</div>
      <div class="aside-picture"><img src="{{app.request.basepath}}/src/images/images-story/emilia-clarke-eye.png" alt=""></div>
    </div>
  </div>
  <!-- Item information-element : END -->
</div>
<div class="image-placeholder"></div>
<div class="overlay"></div>
<div id="panel" class="panel-controller">
  <div id="panel-button" class="switcher"><img src="{{app.request.basepath}}/src/images/right_arrow.svg" alt=""></div>
  <div class="core-controller">
    <div class="body-situation">
      <img src="{{app.request.basepath}}/src/images/story/body.svg" alt="">
    </div>
    <div class="identity">
      <div class="row">
        <div class="data-item">
          <h2>Nom du patient</h2>
          <h3>{{userDB.firstName}} {{userDB.lastName}}</h3>
        </div>
        <div class="data-item">
          <h2>Âge</h2>
          <h3>{{userDB.age}}</h3>
        </div>
      </div>
      <div class="row">
        <div class="data-item">
          <h2>Lieu d'habitation</h2>
          <h3>{{userDB.location}}</h3>
        </div>
        <div class="data-item left">
          <h2>Sexe</h2>
          <h3>{{userDB.gender}}</h3>
        </div>
      </div>
      <div class="row">
        <div class="data-item">
          <h2>Votre progression ADN</h2>
          <img src="{{app.request.basepath}}/src/images/story/adn.svg" alt="">
        </div>
      </div>
    </div>
    <div class="separator"></div>
    <div class="upgrades-status">
      <div class="row">
        <div class="data-item success">
          <h2>Électrodes cervicales</h2>
          <h3>Implanté</h3>
        </div>
        <div class="data-item locked">
          <h2>Recherche d’amélioration</h2>
          <h3>En cours</h3>
        </div>
      </div>
      <div class="row">
        <div class="data-item failed">
          <h2>Prothèses jambaire</h2>
          <h3>Non implanté</h3>
        </div>
        <div class="data-item locked left">
          <h2>Recherche d’amélioration</h2>
          <h3>En cours</h3>
        </div>
      </div>
      <div class="row">
        <div class="data-item locked">
          <h2>Recherche d’amélioration</h2>
          <h3>En cours</h3>
        </div>
        <div class="data-item locked left-2">
          <h2>Recherche d’amélioration</h2>
          <h3>En cours</h3>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="audio-controller"></div>

<script type="text/javascript">


/*
*** SWIPE
*/

function onSwipeValid(direction,page) {

  var that = this;
  that.swipe = {};
  that.swipe.container = document.querySelector('.'+direction+'-choice');

  that.swipe.cursor_signature = document.getElementById('cursor-signature-'+direction);
  that.selected = null, // Object of the element to be moved
  that.x_pos = 0, that.y_pos = 0, // Stores x & y coordinates of the mouse pointer
  that.x_elem = 0, that.y_elem = 0; // Stores top, left values (edge) of the element
  // Will be called when user starts dragging an element

  that._drag_init = function(elem) {
    // Store the object of the element which needs to be moved
    that.selected = elem;
    that.x_elem = that.x_pos - that.selected.offsetLeft;
  }

  // Will be called when user dragging an element
  that.swipe.validation = document.querySelector('#validation-'+direction);
  that.validation_size = parseInt(window.getComputedStyle(that.swipe.validation).getPropertyValue("width").substring(2, -3));
  that.validation_size /= 6.5;
  that.limit = that.swipe.validation.offsetLeft ;

  that._move_elem = function(e) {
    that.x_pos = document.all ? window.event.clientX : e.pageX;
    if (that.selected !== null) {
      var ratio = that.x_pos - that.x_elem;
      if (ratio < 0) {
        ratio = 0;
      } else if (ratio > that.limit) {
        ratio = that.limit + that.validation_size;
        that.swipe.cursor_signature.style.backgroundColor = "green";

        // AJAX REDIRECTION AFTER SWIPE
        var block_page = document.querySelector('.block-page');
        var request = new XMLHttpRequest();
        request.open('GET', '../views/pages/'+page+'.twig', true);
        request.onreadystatechange = function() {
            if(this.readyState == 4) {
                block_page.innerHTML = this.responseText;
            }
        }
        request.send();
        request = null;

      } else if(ratio < 259){
        that.swipe.cursor_signature.style.backgroundColor = "background-color: rgba(79, 136, 255, 1) - #090f1b;";
      }
      that.selected.style.left = ratio + 'px';
    }
  }

  // Destroy the object when we are done
  that._destroy = function() {
    that.selected = null;
  }

  // Bind the functions...
  that.cursor = document.getElementById('cursor-signature-'+direction);
  that.cursor.onmousedown = function () {
    that._drag_init(that.cursor);
    return false;
  };

  this.swipe.container.onmousemove = this._move_elem;
  this.swipe.container.onmouseup = this._destroy;
}

/*
*** TRIGGER DILEMMA 
*/
window.addEventListener("keydown",function(event){
  if (event.which == 32){
    // AJAX
    var block_page = document.querySelector('.block-page');
    var request = new XMLHttpRequest();
    request.open('GET', '../views/pages/dilemma.twig', true);
    request.onreadystatechange = function() {
        if(this.readyState == 4) {
            block_page.innerHTML = this.responseText;
            // TRIGGER FUNCTION SWIPE
            var left = new onSwipeValid("left","browse");
            var right = new onSwipeValid("right","try");
        }
    }
    request.send();
    request = null;
  }
});
</script>

{{include('partials/footer.twig')}}
